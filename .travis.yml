language: python
python:
  - "2.7"
virtualenv:
  system_site_packages: true

# command to prepare the system to install prerequisites or dependencies
before_install:
  # Install Gstreamer
  - sudo add-apt-repository -y ppa:donk/gstreamer
  - sudo apt-get -qq update
  - sudo apt-get install -qq python-gst0.10 gstreamer0.10-plugins-good gstreamer0.10-gnonlin gstreamer0.10-plugins-ugly gstreamer0.10-plugins-bad

  # Install conda
  - sudo pip install conda
  # install deps
  - sudo conda init
  - sudo conda update conda --yes
  - deps="setuptools numpy scipy matplotlib h5py pytables numpydoc sphinx coverage pip"  
  - conda create -p $HOME/py --yes $deps "python=$TRAVIS_PYTHON_VERSION"
  - export PATH=$HOME/py/bin:$PATH
  # Link Python Gstreamer 
  - ln -s  /usr/lib/python2.7/dist-packages/gobject /home/travis/py/lib/python2.7/site-packages/gobject
  - ln -s  /usr/lib/python2.7/dist-packages/glib /home/travis/py/lib/python2.7/site-packages/glib
  - ln -s  /usr/lib/python2.7/dist-packages/gst-0.10 /home/travis/py/lib/python2.7/site-packages/gst-0.10
  - ln -s  /usr/lib/python2.7/dist-packages/pygst.pth /home/travis/py/lib/python2.7/site-packages/pygst.pth
  - ln -s  /usr/lib/python2.7/dist-packages/pygst.py /home/travis/py/lib/python2.7/site-packages/pygst.py

  - ls -l /home/travis/virtualenv/python2.7_with_system_site_packages/local/lib/python2.7/site-packages/
  - ls -l /usr/lib/python2.7/dist-packages/
  - ls -l /home/travis/py/lib/python2.7/site-packages
  - conda info -a
  - conda info -s
  - python -c "import sys; print sys.path"
  # Install TimeSide
  - python setup.py install

# command to run tests
before_script:
  - python tests/get_samples.py
  - pip install coveralls

script:
  - echo $PYTHONPATH 
  - coverage run --source=timeside --omit=timeside/analyzer/aubio/aubio_*.py,timeside/analyzer/yaafe.py,timeside/analyzer/limsi_sad.py,timeside/analyzer/vamp_plugin.py tests/run_all_tests

after_success:
  - coveralls